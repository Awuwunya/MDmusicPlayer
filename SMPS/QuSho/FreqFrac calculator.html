<html>
<head>
    <title>Fraction Frequency calculator for QuackShot</title>
    <script>fratbl = [
        0x00, 0x02, 0x04, 0x07, 0x09, 0x0C, 0x0E, 0x11, 0x13, 0x15, 0x18, 0x1A, 0x1D, 0x1F, 0x22, 0x24,
        0x00, 0x02, 0x05, 0x07, 0x0A, 0x0C, 0x0F, 0x11, 0x14, 0x16, 0x19, 0x1B, 0x1E, 0x20, 0x23, 0x25,
        0x00, 0x02, 0x05, 0x08, 0x0A, 0x0D, 0x10, 0x12, 0x15, 0x18, 0x1A, 0x1D, 0x20, 0x22, 0x25, 0x28,
        0x00, 0x02, 0x05, 0x08, 0x0B, 0x0E, 0x11, 0x14, 0x17, 0x1A, 0x1D, 0x20, 0x23, 0x26, 0x29, 0x2C,
        0x00, 0x02, 0x05, 0x08, 0x0B, 0x0E, 0x11, 0x14, 0x17, 0x1A, 0x1D, 0x20, 0x23, 0x26, 0x29, 0x2C,
        0x00, 0x03, 0x06, 0x09, 0x0C, 0x0F, 0x13, 0x16, 0x19, 0x1C, 0x1F, 0x23, 0x26, 0x29, 0x2C, 0x2F,
        0x00, 0x03, 0x06, 0x0A, 0x0D, 0x10, 0x14, 0x17, 0x1B, 0x1E, 0x21, 0x25, 0x28, 0x2B, 0x2F, 0x32,
        0x00, 0x03, 0x07, 0x0A, 0x0E, 0x12, 0x15, 0x19, 0x1D, 0x20, 0x24, 0x27, 0x2B, 0x2F, 0x32, 0x36,
        0x00, 0x03, 0x07, 0x0B, 0x0F, 0x13, 0x16, 0x1A, 0x1E, 0x22, 0x26, 0x29, 0x2D, 0x31, 0x35, 0x39,
        0x00, 0x04, 0x08, 0x0C, 0x10, 0x14, 0x18, 0x1C, 0x20, 0x24, 0x28, 0x2C, 0x30, 0x34, 0x38, 0x3C,
        0x00, 0x04, 0x08, 0x0C, 0x11, 0x15, 0x19, 0x1D, 0x22, 0x26, 0x2A, 0x2E, 0x33, 0x37, 0x3B, 0x3F,
        0x00, 0x04, 0x09, 0x0D, 0x12, 0x16, 0x1B, 0x1F, 0x24, 0x28, 0x2D, 0x31, 0x36, 0x3A, 0x3F, 0x43,
    ];

        notes = [ "C", "Cs", "D", "Eb", "E", "F", "Fs", "G", "Ab", "A", "Bb", "B" ];
        frtbl = [ 0x284, 0x2AB, 0x2D3, 0x2FE, 0x32D, 0x35C, 0x38F, 0x3C5, 0x3FF, 0x43C, 0x47C, 0x4C0 ];
        setInterval(function(){
            var s = document.getElementById("a").value;

            if(s.indexOf("n") === 0)
                s = s.substring(1);

            var note = -1;
            for (let i = 0; i < notes.length; i++)
            if (s.indexOf(notes[i].toLowerCase()) === 0) {
                note = i;
                s = s.replace(notes[i].toLowerCase(), "");
            }

            if (note < 0) {
                document.getElementById("c").value = ":(";
                document.getElementById("d").value = ":(";
                document.getElementById("e").value = ":(";
                return;
            }

            var ch = document.getElementById("f").checked;
            var oct = s * 0x800;
            var val = parseInt(document.getElementById("b").value, 16);

            var xoff = (note + (ch ? ((-val >> 4) | 0xF0) : (val >> 4)));
            var freq = frtbl[(xoff + 0x80) % 0xC];
            var frac = fratbl[((note << 4) + (ch ? (0xC0 - val) : val)) % 0xC0];
            var roct = oct + (ch ? (xoff < 0 ? -0x800 : 0) : (xoff > 0xC ? 0x800 : 0));
            document.getElementById("c").value = '$'+ (frac + freq + roct).toString(16);
            document.getElementById("d").value = 'n'+ notes[(xoff + 0x80) % 0xC] + (roct / 0x800);
            document.getElementById("e").value = '$'+ frac.toString(16);
        }, 250);
    </script>
</head>
<body>
Input base note: <input id="a" /> Input value (hex): <input id="b" /> Negated: <input type="checkbox" id="f" /> <br/>
Output Frequency: <input id="c" /> Output Note: <input id="d" /> Output Detune: <input id="e" />
</body>
</html>
